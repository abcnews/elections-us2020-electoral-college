@import '../../constants.scss';

// TappableLayer enum
$TappableLayer_Delegates: 0;
$TappableLayer_States: 1;

// Focus management
$opacityUnfocused: 0.125;
$focusChangeTransitionDuration: 0.25s;

@mixin fadedOut {
  opacity: $opacityUnfocused;
}

@mixin fadedOutTransitionable {
  transition: opacity $focusChangeTransitionDuration;
}

.root {
  position: relative;
}

.svg {
  margin: auto;
  width: 100%;
  height: auto;
  vertical-align: bottom;
}

.countryOuter {
  @include fadedOutTransitionable;
}

.root[data-has-focuses] .countryOuter {
  @include fadedOut;
}

.countryOuter path {
  stroke: #000;
  stroke-width: 5.5;
  fill: none;
}

.countryInner path {
  stroke: none;
  fill: $color_BG;
}

.delegates {
  pointer-events: none;
}

.root[data-tappable='#{$TappableLayer_Delegates}'] .delegates {
  pointer-events: all;
}

.delegate {
  @include fadedOutTransitionable;
}

.root[data-has-focuses] .delegate[data-focus='#{$Focus_No}'] {
  @include fadedOut;
}

.delegateAllocation {
  color: $color_None;
  fill: currentColor;
  stroke: none;
  stroke-width: 6.5; // For flip animation strokes
}

.delegateAllocation[data-allocation='#{$Allocation_Dem}'] {
  color: $color_Dem;
}

.delegateAllocation[data-allocation='#{$Allocation_LikelyDem}'] {
  color: $color_LikelyDem;
}

.delegateAllocation[data-allocation='#{$Allocation_Tossup}'] {
  color: $color_Tossup;
}

.delegateAllocation[data-allocation='#{$Allocation_LikelyGOP}'] {
  color: $color_LikelyGOP;
}

.delegateAllocation[data-allocation='#{$Allocation_GOP}'] {
  color: $color_GOP;
}

@keyframes flippedDemToGOP {
  0% {
    fill: none;
    stroke: $color_Dem;
    transform: none;
  }
  49.99% {
    fill: none;
    stroke: $color_Dem;
    transform: rotateY(90deg);
  }
  50% {
    fill: $color_GOP;
    stroke: none;
    transform: rotateY(-90deg);
  }
  100% {
    fill: $color_GOP;
    stroke: none;
    transform: none;
  }
}

@keyframes flippedGOPToDem {
  0% {
    fill: none;
    stroke: $color_GOP;
    transform: none;
  }
  49.99% {
    fill: none;
    stroke: $color_GOP;
    transform: rotateY(90deg);
  }
  50% {
    fill: $color_Dem;
    stroke: none;
    transform: rotateY(-90deg);
  }
  100% {
    fill: $color_Dem;
    stroke: none;
    transform: none;
  }
}

.delegateAllocation[data-relative-allocation='#{$Allocation_GOP}'][data-allocation='#{$Allocation_Dem}'] {
  animation: flippedGOPToDem 1.5s ease-in-out 0.5s 1 both;
}

.delegateAllocation[data-relative-allocation='#{$Allocation_Dem}'][data-allocation='#{$Allocation_GOP}'] {
  animation: flippedDemToGOP 1.5s ease-in-out 0.5s 1 both;
}

.delegateTarget {
  stroke: none;
  fill: none;
}

.root[data-is-interactive][data-tappable='#{$TappableLayer_States}'] .delegateTarget {
  cursor: pointer;
}

.states {
  pointer-events: none;
}

.root[data-tappable='#{$TappableLayer_States}'] .states {
  pointer-events: all;
}

.state {
  @include fadedOutTransitionable;
}

.root[data-has-focuses] .state[data-focus='#{$Focus_No}'] {
  @include fadedOut;
}

.stateFocus {
  stroke: rgba(128, 128, 128, 0.25);
  fill: none;
  stroke-width: 1.5;
}

.stateFocus[data-focus='#{$Focus_Yes}'],
.stateFocus[data-focus='#{$Focus_Dem}'],
.stateFocus[data-focus='#{$Focus_GOP}'] {
  stroke-width: 5.5;
}

.stateFocus[data-focus='#{$Focus_Yes}'] {
  stroke: #000;
}

.stateFocus[data-focus='#{$Focus_Dem}'] {
  stroke: rgb(52, 127, 178);
}

.stateFocus[data-focus='#{$Focus_GOP}'] {
  stroke: rgb(191, 22, 34);
}

.stateFocus[data-has-allocation] {
  stroke-width: 2.5;
  stroke: $color_BG;
}

.stateFocus[data-focus='#{$Focus_Yes}'][data-has-allocation],
.stateFocus[data-focus='#{$Focus_Dem}'][data-has-allocation],
.stateFocus[data-focus='#{$Focus_GOP}'][data-has-allocation] {
  stroke-width: 0;
  stroke: none;
}

.stateTarget {
  stroke: none;
  fill: none;
}

.root[data-is-interactive][data-tappable='#{$TappableLayer_States}'] .stateTarget {
  cursor: pointer;
}

.labels {
  pointer-events: none;
}

.label {
  text-anchor: middle;
  dominant-baseline: middle;
  font-size: 1rem;
  fill: $color_Text;
  stroke: none;
  @include fadedOutTransitionable;
}

.label[data-most-definitively-allocated] {
  fill: $color_BG;
  text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5);
}

.root[data-has-focuses] .label[data-focus='#{$Focus_No}'] {
  @include fadedOut;
  fill: $color_Text;
  text-shadow: none;
}
